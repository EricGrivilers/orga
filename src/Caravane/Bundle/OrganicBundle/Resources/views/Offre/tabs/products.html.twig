<div class="row">
    <div class="col-md-12">
        {{form_row(edit_form.surface)}}
    </div>
</div>
<div class="row">
    <div class="col-md-12">
        <table class="table table-bordered table-condensed table-striped table-sortable" data-option="0">
            <thead>
                <tr>
                    <th>
                        Product
                    </th>
                    <th>
                        Price in &euro; VAT excl.
                    </th>
                    <th class="tiny"></th>
                </tr>
            </thead>
            <tbody class="products" id="products" {% if entity.id %} data-update="{{path('offre_sort_products',{'id':entity.id})}}" {% endif %} data-prototype="{{('
                        <td class="col-md-9">'~form_widget(edit_form.products.vars.prototype.description)~' '~form_widget(edit_form.products.vars.prototype.datas)~'</td>
                        <td class="col-md-3">'~form_widget(edit_form.products.vars.prototype.price)~'</td>
                        <td>'~form_widget(edit_form.products.vars.prototype.isoption)~'<a class="delete_new_row" ><i class="fa fa-trash-o"></i></a></td>
                    ')|e}}">
                    {% set c=0 %}
                    {%  set floors =[] %}
                {% for product in edit_form.products  %}

                    {% if product.isoption.vars.data!=true %}
                        {% if product.vars.value.tentid.productCategory.floor|default  %}
                            {% set floors = floors|merge([product])  %}
                        {%  else %}
                            <tr data-productid="{{c}}" data-entity="{{product.vars.value.id}}" {% if product.vars.value.toremove %} class="error" {% endif %}>
                                <td class="col-md-9">
                                    {{form_widget(product.description)}}
                                    {{form_widget(product.datas)}}

                                </td>
                                <td class="col-md-3">
                                    {{form_widget(product.price)}}
                                </td>
                                <td>{{form_widget(product.isoption)}}<a class="delete_row" data-rel="{{entity.id}}" data-type="offre" data-target="{{product.vars.value.id}}"><i class="fa fa-trash-o"></i></a></td>
                            </tr>
                        {%  endif  %}
                    {% endif %}
                    {% set c=c+1 %}
                {% endfor %}

                {% if floors|length >0  %}
                    {%  set product = floors[0] %} %}
                    <tr data-productid="{{c}}" data-entity="{{product.vars.value.id}}" {% if product.vars.value.toremove %} class="error" {% endif %}>
                        <td class="col-md-9">
                            {{form_widget(product.description)}}
                            {{form_widget(product.datas)}}
                            {{ floors|length }} 
                        </td>
                        <td class="col-md-3">
                            {{form_widget(product.price)}}
                        </td>
                        <td>{{form_widget(product.isoption)}}<a class="delete_row" data-rel="{{entity.id}}" data-type="offre" data-target="{{product.vars.value.id}}"><i class="fa fa-trash-o"></i></a></td>
                    </tr>
                {% endif %}


            </tbody>
             <tfoot>
                <tr>
                        <th class="right">

                            <a data-rel="{{entity.id}}" id="add_product_link" class="add_product_link btn btn-default" data-isoption='0'>Add free row</a>
                            <a href="#transportModal" class="btn btn-default openTransportModal" data-isoption='0'>Add transport row</a>
                             {% if entity.id and entity.builddate and entity.unbuilddate %}
                                <a href="#stockModal"  class="btn btn-default openStockModal"  data-isoption='0'>Add from stock</a>
                            {% else %}
                                <a href="#stockModal"  class="btn btn-default disabled"  data-isoption='0'>Add from stock</a><br/>
                                You must give planning dates and save this offer to be able to add product from stock
                            {% endif %}
                        </th>
                        <th>

                        </th>
                        <th class="tiny"></th>
                </tr>
                    <tr>
                        <th class="right">
                            Total VAT excl.
                        </th>
                        <th>
                            {% set total=0 %}
                            {% for p in entity.products %}
                                {% if p.isoption!=true %}
                                    {% set total=total + p.price %}
                                {% endif %}
                            {% endfor %}
                            {{total|number_format(2,',',' ')}}
                        </th>
                        <th class="tiny"></th>
                </tr>


                    <tr>
                        <th class="right">
                             {{form_widget(edit_form.pricetype)}}
                        </th>
                        <th>
                            {% if entity.pricetype!='intra'%} {{(0.21*total)|number_format(2,',',' ')}} {% endif %}
                        </th>
                        <th class="tiny"></th>
                    </tr>
                    <tr>
                        <th class="right">
                            Total {% if entity.pricetype!='intra'%} VAT incl. {% endif %}
                        </th>
                        <th>
                            {% if entity.pricetype=='intra'%}
                                {{total|number_format(2,'.',' ')}}
                            {% else %}
                                {{(total+0.21*total)|number_format(2,'.',' ')}}
                            {% endif %}
                        </th>
                        <th></th>
                    </tr>

            </tfoot>
        </table>
    </div>
</div>
<div class="row">
    <div class="col-md-12">
        {{form_row(edit_form.tentscomments)}}
    </div>
</div>

<div classss="row">
    <div class="col-md-12">


        <h4>Options</h4>
        <div class="row">
            <div class="col-md-12">
              {{form_row(edit_form.tentscomments)}}
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">

                <table class="table table-bordered table-condensed table-striped table-sortable" data-option="1">
                    <thead>
                        <tr>
                            <th>
                                Product
                            </th>
                            <th>
                                Price in &euro; VAT excl.
                            </th>
                            <th class="tiny"></th>
                        </tr>
                    </thead>
                    <tbody class="products "  {% if entity.id %} data-update="{{path('offre_sort_products',{'id':entity.id})}}" {% endif %}  >

                        {% for product in edit_form.products  %}
                               {% if product.isoption.vars.data==true %}
                            <tr  data-entity="{{product.vars.value.id}}">
                                <td class="col-md-9">

                                    {{form_widget(product.description)}}
                                    {{form_widget(product.datas)}}
                                </td>
                                <td class="col-md-3">
                                    {{form_widget(product.price)}}
                                </td>
                                <td>{{form_widget(product.isoption)}}<a class="delete_row" data-rel="{{entity.id}}" data-type="offre" data-target="{{product.vars.value.id}}"><i class="fa fa-trash-o"></i></a></td>
                            </tr>
                            {% endif %}
                        {% endfor %}


                    </tbody>
                     <tfoot>
                        <tr>
                                <th class="right">

                                    <a data-rel="{{entity.id}}" id="add_option_link" class="add_product_link btn btn-default" data-isoption='1'>Add free row</a>
                                    <a href="#transportModal" class="btn btn-default openTransportModal" data-isoption='1'>Add transport row</a>

                                    {% if entity.id and entity.builddate and entity.unbuilddate %}
                                        <a href="#stockModal"  class="btn btn-default openStockModal" data-isoption='1'>Add from stock</a>
                                    {% else %}
                                        <a href="#stockModal"  class="btn btn-default disabled" data-isoption='1'>Add from stock</a>
                                        <br/> You must give planning dates and save this offer to be able to add product from stock
                                    {% endif %}
                                </th>
                                <th>

                                </th>
                                <th class="tiny"></th>
                        </tr>
                            <tr>
                                <th class="right">
                                    Total VAT excl.
                                </th>
                                <th>
                                    {% set total=0 %}
                                    {% for p in entity.products %}
                                         {% if p.isoption==true %}
                                            {% set total=total + p.price %}
                                        {% endif %}
                                    {% endfor %}
                                    {{total|number_format(2,',',' ')}}
                                </th>
                                <th class="tiny"></th>
                        </tr>


                            <tr>
                                <th class="right">
                                    {% if entity.pricetype!='intra'%} VAT {% endif %}
                                </th>
                                <th>
                                    {% if entity.pricetype!='intra'%} {{(0.21*total)|number_format(2,',',' ')}} {% endif %}
                                </th>
                                <th class="tiny"></th>
                            </tr>
                            <tr>
                                <th class="right">
                                    Total {% if entity.pricetype!='intra'%} VAT incl. {% endif %}
                                </th>
                                <th>
                                    {% if entity.pricetype=='intra'%}
                                        {{total|number_format(2,'.',' ')}}
                                    {% else %}
                                        {{(total+0.21*total)|number_format(2,'.',' ')}}
                                    {% endif %}
                                </th>
                                <th></th>
                            </tr>

                    </tfoot>
                </table>
            </div>
        </div>
    </div>
</div>
