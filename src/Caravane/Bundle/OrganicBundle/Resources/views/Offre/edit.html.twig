{% extends "::base.html.twig" %}


{% block body %}

<div class="row-fluid">

{% block form_header %}
<form action="{{ path('offre_update', { 'id': entity.id }) }}" method="post" {{ form_enctype(edit_form) }}>
{% endblock form_header %}
 <div class="row-fluid">
        <div class="actions">
            <button type="submit" class="btn btn-inverse">Save</button>
            <a href="{{ path('offre') }}" class="btn">
                    Back to the list
            </a>
        </div>
    </div>
    <div class="well">
        <div class="row-fluid">
            <div class="span4">
                <div>
                    <label>Reference</label> <label><b>{{entity.reference}}</b></label>
                </div>
                <div>
                    <label>Date</label> <label><b>{{entity.insertDate|date('d/m/Y')}}</b></label>
                </div>

            </div>
            <div class="span4">
               {{ form_row(edit_form.offretype)}}
               {{ form_row(edit_form.userid)}}
            </div>
            <div class="span4">
               {{ form_row(edit_form.status)}}

            </div>
        </div>
    </div>
    <div class="well">
        <div class="row-fluid">
            {% set ToPay = entity.price %}
            {% if entity.pricetype!='intra'%}
                {% set ToPay = entity.price+(entity.price*0.21) %}
            {% endif %}
            <div class="span6">
                <h4 style="text-align:center">Total amount {{ToPay|number_format(2,',',' ')}} {% if entity.pricetype!='intra'%}VAT incl.{% endif %}</h4>
            </div>
             <div class="span6">
                {{ form_row(edit_form.pricecomments)}}
            </div>
        </div>
    </div>

    <h4>Client</h4>
    <div class="well">
        <div class="row-fluid" >
            <div class="span4">
                {{form_row(edit_form.clientid.clienttype)}}
            </div>
             <div class="span4">
                &nbsp;
            </div>
             <div class="span4">
                {{form_row(edit_form.clientid.language)}}
            </div>
         </div>
        <div class="row-fluid" id="cieonly">
            <div class="span4">
                {{form_row(edit_form.clientid.name)}}

            </div>
             <div class="span4">
                {{form_row(edit_form.clientid.vat)}}

            </div>
             <div class="span4">
                {{form_row(edit_form.clientid.cietype)}}

            </div>
        </div>
        <div class="row-fluid">
            <div class="span4">
                {{form_row(edit_form.clientid.clienttitle)}}
            </div>
             <div class="span4">
                {{form_row(edit_form.clientid.lastname)}}
            </div>
             <div class="span4">
                {{form_row(edit_form.clientid.firstname)}}

            </div>
        </div>
    </div>

     <div class="well">
        <div class="row-fluid">
            <div class="span4">
                {{form_row(edit_form.clientid.address)}}
                {{form_row(edit_form.clientid.city)}}
                {{form_row(edit_form.clientid.country)}}
                {{form_row(edit_form.clientid.url)}}
            </div>
             <div class="span4">
                {{form_row(edit_form.clientid.number)}}
                {{form_row(edit_form.clientid.zip)}}
            </div>
             <div class="span4">
                {{form_row(edit_form.clientid.email)}}
                {{form_row(edit_form.clientid.mobile)}}
                {{form_row(edit_form.clientid.phone)}}
                {{form_row(edit_form.clientid.phone2)}}
                {{form_row(edit_form.clientid.fax)}}

            </div>
        </div>
    </div>
     <h4>Quote</h4>
      <div class="well">
        <div class="row-fluid">
            <div class="span4">
                {{form_row(edit_form.address)}}
                 {{form_row(edit_form.number)}}
                {{form_row(edit_form.city)}}
                {{form_row(edit_form.zip)}}
                {{form_row(edit_form.country)}}
                {{form_row(edit_form.url)}}


            </div>
            <div class="span4">
                {{form_row(edit_form.email)}}
                {{form_row(edit_form.mobile)}}
                {{form_row(edit_form.phone)}}
                {{form_row(edit_form.phone2)}}
                {{form_row(edit_form.fax)}}

            </div>
             <div class="span4">

                {{form_row(edit_form.offrecomments)}}
            </div>

        </div>
    </div>
    <h4>Planning</h4>
    <div class="well">
        <div class="row-fluid">
            <table class="table">
                <thead>
                    <tr>
                        <th>#
                        </th>
                        <th>From
                        </th>
                        <th>To
                        </th>
                        <th>
                        </th>
                        <th>In charge
                        </th>
                    </tr>
                </thead>
                <tbody >
                {% for planning in edit_form.plannings %}
                    <tr class='widget'>
                        <td><label><b>{{planning.vars.value.planningtype}}</b></label></td>
                        <td>{{form_widget(planning.startdate)}}</td>
                        <td>{{form_widget(planning.enddate)}}</td>
                        <td><div class="reportrange" >
            <i class="icon-calendar icon-large"></i>
            <span class='display'><span class='static'>From </span> {{planning.vars.value.startdate|date('d/m/Y H:i:s')}} <span class='static'> to </span> {{planning.vars.value.enddate|date('d/m/Y H:i:s')}}</span> <b class="caret"></b>
        </div>
        {#{dump(planning)}#}</td>
                        <td>{{form_widget(planning.userid)}}</td>
                    </tr>
                {% endfor %}
            </tbody>
            </table>
        </div>
    </div>

    <h4>Products</h4>
    <div class="row-fluid">
          {{form_row(edit_form.tentscomments)}}
    </div>
    <div class="row-fluid">

        <table class="table table-bordered table-condensed table-striped">
            <thead>
                <tr>
                    <th>
                        Product
                    </th>
                    <th>
                        Price in &euro; VAT excl.
                    </th>
                    <th class="tiny"></th>
                </tr>
            </thead>
            <tbody class="products" id="products"  data-prototype="{{('
                        <td class="span9">'~form_widget(edit_form.products.vars.prototype.description)~'</td>
                        <td class="span3">'~form_widget(edit_form.products.vars.prototype.price)~'</td>
                        <td>'~form_widget(edit_form.products.vars.prototype.isoption)~'<a class="delete_new_row" ><i class="icon icon-trash"></i></a></td>
                    ')|e}}">

                {% for product in edit_form.products  %}

                    {% if product.isoption.vars.data!=true %}
                    <tr>
                        <td class="span9">
                            {{form_widget(product.description)}}
                        </td>
                        <td class="span3">
                            {{form_widget(product.price)}}
                        </td>
                        <td>{{form_widget(product.isoption)}}<a class="delete_row" data-rel="{{entity.id}}" data-type="invoice" data-target="{{product.vars.value.id}}"><i class="icon icon-trash"></i></a></td>
                    </tr>
                    {% endif %}
                {% endfor %}


            </tbody>
             <tfoot>
                <tr>
                        <th class="right">

                            <a id="add_product_link" class="add_product_link btn" data-isoption='0'>Add free row</a>
                            <a href="#stockModal"  class="btn" data-toggle="modal" data-isoption='0'>Add from stock</a>
                        </th>
                        <th>

                        </th>
                        <th class="tiny"></th>
                </tr>
                    <tr>
                        <th class="right">
                            Total VAT excl.
                        </th>
                        <th>
                            {% set total=0 %}
                            {% for p in entity.products %}
                                {% if p.isoption!=true %}
                                    {% set total=total + p.price %}
                                {% endif %}
                            {% endfor %}
                            {{total|number_format(2,',',' ')}}
                        </th>
                        <th class="tiny"></th>
                </tr>


                    <tr>
                        <th class="right">
                             {{form_widget(edit_form.pricetype)}}
                        </th>
                        <th>
                            {% if entity.pricetype!='intra'%} {{(0.21*total)|number_format(2,',',' ')}} {% endif %}
                        </th>
                        <th class="tiny"></th>
                    </tr>
                    <tr>
                        <th class="right">
                            Total {% if entity.pricetype!='intra'%} VAT incl. {% endif %}
                        </th>
                        <th>
                            {% if entity.pricetype=='intra'%}
                                {{total|number_format(2,'.',' ')}}
                            {% else %}
                                {{(total+0.21*total)|number_format(2,'.',' ')}}
                            {% endif %}
                        </th>
                        <th></th>
                    </tr>

            </tfoot>
        </table>
    </div>


    <h4>Options</h4>
    <div class="row-fluid">
          {{form_row(edit_form.tentscomments)}}
    </div>
    <div class="row-fluid">

        <table class="table table-bordered table-condensed table-striped">
            <thead>
                <tr>
                    <th>
                        Product
                    </th>
                    <th>
                        Price in &euro; VAT excl.
                    </th>
                    <th class="tiny"></th>
                </tr>
            </thead>
            <tbody class="products" >

                {% for product in edit_form.products  %}
                       {% if product.isoption.vars.data==true %}
                    <tr>
                        <td class="span9">

                            {{form_widget(product.description)}}
                        </td>
                        <td class="span3">
                            {{form_widget(product.price)}}
                        </td>
                        <td>{{form_widget(product.isoption)}}<a class="delete_row" data-rel="{{entity.id}}" data-type="invoice" data-target="{{product.vars.value.id}}"><i class="icon icon-trash"></i></a></td>
                    </tr>
                    {% endif %}
                {% endfor %}


            </tbody>
             <tfoot>
                <tr>
                        <th class="right">

                            <a id="add_option_link" class="add_product_link btn" data-isoption='1'>Add free row</a>
                            <a href="#stockModal"  class="btn" data-toggle="modal" data-isoption='1'>Add from stock</a>
                        </th>
                        <th>

                        </th>
                        <th class="tiny"></th>
                </tr>
                    <tr>
                        <th class="right">
                            Total VAT excl.
                        </th>
                        <th>
                            {% set total=0 %}
                            {% for p in entity.products %}
                                 {% if p.isoption==true %}
                                    {% set total=total + p.price %}
                                {% endif %}
                            {% endfor %}
                            {{total|number_format(2,',',' ')}}
                        </th>
                        <th class="tiny"></th>
                </tr>


                    <tr>
                        <th class="right">
                            {% if entity.pricetype!='intra'%} VAT {% endif %}
                        </th>
                        <th>
                            {% if entity.pricetype!='intra'%} {{(0.21*total)|number_format(2,',',' ')}} {% endif %}
                        </th>
                        <th class="tiny"></th>
                    </tr>
                    <tr>
                        <th class="right">
                            Total {% if entity.pricetype!='intra'%} VAT incl. {% endif %}
                        </th>
                        <th>
                            {% if entity.pricetype=='intra'%}
                                {{total|number_format(2,'.',' ')}}
                            {% else %}
                                {{(total+0.21*total)|number_format(2,'.',' ')}}
                            {% endif %}
                        </th>
                        <th></th>
                    </tr>

            </tfoot>
        </table>
    </div>

<div id="stockModal" class="modal hide fade largeModal" tabindex="-1" role="dialog" aria-labelledby="stockModalLabel" aria-hidden="true">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
        <h3>Stock</h3>
      </div>
      <div class="modal-body">
            <div class='row-fluid' id="products">
                <ul class="nav nav-tabs" id="myTab">
                    {% for category in productCategories %}
                         <li {% if loop.index==1%} class='active' {% endif %}><a href="#cat{{category.id}}" data-toggle="tab" >{{category}}</a></li>
                    {% endfor %}
                </ul>

                <div class="tab-content">
                    {% for category in productCategories %}

                         <div class="tab-pane {% if loop.index==1 %} active {% endif %}" id="cat{{category.id}}" >
                            {% render "CaravaneOrganicBundle:Tent:getAvailable" with { 'entity':entity,'categoryId':category.id, 'startDate' : edit_form.plannings[1].vars.value.startDate ,'endDate': edit_form.plannings[3].vars.value.endDate} %}
                         </div>
                    {% endfor %}
                </div>
            </div>
      </div>
      <div class="modal-footer">


      </div>
</div>





{#
    <div class="well">
        {{form_row(edit_form.clientid)}}
        {{form_row(edit_form.clienttype)}}
        <div class="row-fluid" id="cieonly" {% if entity.clienttype=='part' %} style="display:none" {% endif %}>
            <div class="span4">
                {{form_row(edit_form.name)}}

            </div>
             <div class="span4">
                {{form_row(edit_form.vat)}}

            </div>
             <div class="span4">
                {{form_row(edit_form.cietype)}}

            </div>
        </div>
        <div class="row-fluid">
            <div class="span4">
                {{form_row(edit_form.clienttitle)}}
            </div>
             <div class="span4">
                {{form_row(edit_form.lastname)}}
            </div>
             <div class="span4">
                {{form_row(edit_form.firstname)}}

            </div>
        </div>
    </div>

     <div class="well">
        <div class="row-fluid">
            <div class="span4">
                {{form_row(edit_form.address)}}
                {{form_row(edit_form.city)}}

            </div>
             <div class="span4">
                {{form_row(edit_form.number)}}
                {{form_row(edit_form.zip)}}
            </div>
             <div class="span4">
                {{form_row(edit_form.country)}}

            </div>
        </div>
    </div>
#}







    {{ form_widget(edit_form) }}
    <p>
        <button type="submit">Edit</button>
    </p>
     <div class="row-fluid">
        <div class="actions">
            <button type="submit" class="btn btn-inverse">Save</button>
            <a href="{{ path('offre') }}" class="btn">
                    Back to the list
            </a>
        </div>
    </div>
</form>

</div>
{% endblock body %}
