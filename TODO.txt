#######
##
##  before doctrine:schema:update
##
##
#######

RENAME TABLE  `extra_addresses` TO  `address` ;
RENAME TABLE  `extra_chat` TO  `chat` ;
RENAME TABLE  `extra_clients` TO  `client` ;
RENAME TABLE  `extra_documents` TO  `document` ;
RENAME TABLE  `extra_invoices` TO  `invoice` ;
RENAME TABLE  `extra_jobs` TO  `job` ;
RENAME TABLE  `extra_offres` TO  `offre` ;
RENAME TABLE  `extra_planning` TO  `planning` ;
RENAME TABLE  `extra_planning2job` TO  `planning2job` ;
RENAME TABLE  `extra_planning2offre` TO  `planning2offre` ;
RENAME TABLE  `extra_planning_logs` TO  `planning_logs` ;
RENAME TABLE  `extra_product2invoice` TO  `product2invoice` ;
RENAME TABLE  `extra_product2job` TO  `product2job` ;
RENAME TABLE  `extra_product2offre` TO  `product2offre` ;
RENAME TABLE  `extra_slices` TO  `slice` ;
RENAME TABLE  `extra_slice2job` TO  `slice2job` ;
RENAME TABLE  `extra_slice2offre` TO  `slice2offre` ;
RENAME TABLE  `extra_tents` TO  `tent` ;
RENAME TABLE  `extra_tent2job` TO  `tent2job` ;
RENAME TABLE  `extra_tent2offre` TO  `tent2offre` ;
RENAME TABLE  `extra_tents_colors` TO  `tents_colors` ;
RENAME TABLE  `extra_users` TO  `user` ;




ALTER TABLE  `address` ENGINE = INNODB;
ALTER TABLE  `chat` ENGINE = INNODB;
ALTER TABLE  `client` ENGINE = INNODB;
ALTER TABLE  `document` ENGINE = INNODB;
ALTER TABLE  `invoice` ENGINE = INNODB;
ALTER TABLE  `job` ENGINE = INNODB;
ALTER TABLE  `offre` ENGINE = INNODB;
ALTER TABLE  `planning` ENGINE = INNODB;
ALTER TABLE  `planning2job` ENGINE = INNODB;
ALTER TABLE  `planning2offre` ENGINE = INNODB;
ALTER TABLE  `planning_logs` ENGINE = INNODB;
ALTER TABLE  `product2invoice` ENGINE = INNODB;
ALTER TABLE  `product2job` ENGINE = INNODB;
ALTER TABLE  `product2offre` ENGINE = INNODB;
ALTER TABLE  `slice` ENGINE = INNODB;
ALTER TABLE  `slice2job` ENGINE = INNODB;
ALTER TABLE  `slice2offre` ENGINE = INNODB;
ALTER TABLE  `tent` ENGINE = INNODB;
ALTER TABLE  `tent2job` ENGINE = INNODB;
ALTER TABLE  `tent2offre` ENGINE = INNODB;
ALTER TABLE  `tents_colors` ENGINE = INNODB;
ALTER TABLE  `user` ENGINE = INNODB;


ALTER TABLE  `client` CHANGE  `userId`  `userId` INT( 11 ) NULL DEFAULT NULL ;


ALTER TABLE  `planning` CHANGE  `planningId`  `id` INT( 11 ) NOT NULL AUTO_INCREMENT ;
ALTER TABLE  `address` CHANGE  `addressId`  `id` INT( 11 ) NOT NULL AUTO_INCREMENT;
ALTER TABLE  `chat` CHANGE  `chatId`  `id` INT( 11 ) NOT NULL AUTO_INCREMENT;
ALTER TABLE  `tent` CHANGE  `tentId`  `id` INT( 11 ) NOT NULL AUTO_INCREMENT;
ALTER TABLE  `user` CHANGE  `userId`  `id` INT( 11 ) NOT NULL AUTO_INCREMENT;
ALTER TABLE  `client` CHANGE  `clientId`  `id` INT( 11 ) NOT NULL AUTO_INCREMENT;
ALTER TABLE  `offre` CHANGE  `offreId`  `id` INT( 11 ) NOT NULL AUTO_INCREMENT;
ALTER TABLE  `invoice` CHANGE  `invoiceId`  `id` INT( 11 ) NOT NULL AUTO_INCREMENT;
ALTER TABLE  `invoice` CHANGE  `jobId`  `jobId` INT( 11 ) NULL DEFAULT NULL;
ALTER TABLE  `job` CHANGE  `jobId`  `id` INT( 11 ) NOT NULL AUTO_INCREMENT;
ALTER TABLE  `document` CHANGE  `documentId`  `id` INT( 11 ) NOT NULL AUTO_INCREMENT;



ALTER TABLE  `job` CHANGE  `userId`  `userId` INT( 11 ) NULL DEFAULT NULL ;


ALTER TABLE  `slice` ADD  `id` INT( 11 ) NULL AUTO_INCREMENT FIRST ,
ADD PRIMARY KEY (  `id` ) ;



ALTER TABLE `product2offre` CHANGE `productId` `productId` INT(11) NULL, CHANGE `offreId` `offreId` INT(11) NULL, CHANGE `jobId` `jobId` INT(11) NULL;

ALTER TABLE  `product2invoice` CHANGE  `productId`  `productId` INT( 11 ) NULL ,
CHANGE  `invoiceId`  `invoiceId` INT( 11 ) NULL;

ALTER TABLE  `tent2job` CHANGE  `offreId`  `offreId` INT( 11 ) NULL ,
CHANGE  `tentId`  `tentId` INT( 11 ) NULL;

ALTER TABLE  `tent2offre` CHANGE  `offreId`  `offreId` INT( 11 ) NULL ,
CHANGE  `tentId`  `tentId` INT( 11 ) NULL;

ALTER TABLE  `product2job` CHANGE  `productId`  `productId` INT( 11 ) NULL ,
CHANGE  `offreId`  `offreId` INT( 11 ) NULL ,
CHANGE  `jobId`  `jobId` INT( 11 ) NULL;


ALTER TABLE  `planning2job` CHANGE  `jobId`  `jobId` INT( 11 ) NULL DEFAULT NULL ,
CHANGE  `offreId`  `offreId` INT( 11 ) NULL DEFAULT NULL ,
CHANGE  `userId`  `userId` INT( 11 ) NOT NULL;

ALTER TABLE  `planning2offre` CHANGE  `jobId`  `jobId` INT( 11 ) NULL DEFAULT NULL ,
CHANGE  `offreId`  `offreId` INT( 11 ) NULL DEFAULT NULL ,
CHANGE  `userId`  `userId` INT( 11 ) NOT NULL;


ALTER TABLE  `planning2job` CHANGE  `userId`  `userId` INT( 11 ) NULL;


ALTER TABLE  `planning2offre` CHANGE  `planningId`  `id` INT( 11 ) NOT NULL AUTO_INCREMENT ;
ALTER TABLE  `planning2offre` CHANGE  `userId`  `userId` INT( 11 ) NULL;
ALTER TABLE  `chat` CHANGE  `userId`  `userId` INT( 100 ) NULL ;


ALTER TABLE  `planning_logs` CHANGE  `planningId`  `id` INT( 11 ) NOT NULL AUTO_INCREMENT ;
ALTER TABLE  `planning_logs` CHANGE  `jobId`  `jobId` INT( 11 ) NULL DEFAULT NULL ,
CHANGE  `offreId`  `offreId` INT( 11 ) NULL DEFAULT NULL;

ALTER TABLE  `slice` CHANGE  `offreId`  `offreId` INT( 11 ) NULL DEFAULT NULL ,
CHANGE  `jobId`  `jobId` INT( 11 ) NULL DEFAULT NULL ,
CHANGE  `invoiceId`  `invoiceId` INT( 11 ) NULL DEFAULT NULL ,
CHANGE  `sliceId`  `sliceId` INT( 11 ) NULL DEFAULT NULL;

ALTER TABLE  `slice2job` CHANGE  `offreId`  `offreId` INT( 11 ) NULL DEFAULT NULL ,
CHANGE  `jobId`  `jobId` INT( 11 ) NULL DEFAULT NULL ,
CHANGE  `invoiceId`  `invoiceId` INT( 11 ) NULL DEFAULT NULL ,
CHANGE  `sliceId`  `sliceId` INT( 11 ) NULL DEFAULT NULL;

ALTER TABLE  `slice2job` ADD  `id` INT( 11 ) NOT NULL AUTO_INCREMENT FIRST ,
ADD PRIMARY KEY (  `id` ) ;



ALTER TABLE  `slice2offre` CHANGE  `offreId`  `offreId` INT( 11 ) NULL DEFAULT NULL ,
CHANGE  `jobId`  `jobId` INT( 11 ) NULL DEFAULT NULL ,
CHANGE  `invoiceId`  `invoiceId` INT( 11 ) NULL DEFAULT NULL ,
CHANGE  `sliceId`  `sliceId` INT( 11 ) NULL DEFAULT NULL;

ALTER TABLE  `tent2offre` CHANGE  `offreId`  `offreId` INT( 11 ) NULL DEFAULT NULL ,
CHANGE  `tentId`  `tentId` INT( 11 ) NULL DEFAULT NULL ,
CHANGE  `jobId`  `jobId` INT( 11 ) NULL DEFAULT NULL;


ALTER TABLE  `job` ADD  `toffreid` INT( 11 ) NOT NULL;

ALTER TABLE  `address` CHANGE  `clientId`  `clientId` INT( 11 ) NULL ;
ALTER TABLE  `address` CHANGE  `clientId`  `clientId` INT( 11 ) NULL DEFAULT NULL ,
CHANGE  `invoiceId`  `invoiceId` INT( 11 ) NULL DEFAULT NULL ,
CHANGE  `offreId`  `offreId` INT( 11 ) NULL DEFAULT NULL ;


ALTER TABLE  `client` CHANGE  `jobId`  `jobId` INT( 11 ) NULL ;
ALTER TABLE  `client` CHANGE  `userId`  `userId` MEDIUMINT( 11 ) NULL ;

ALTER TABLE  `job` CHANGE  `offreId`  `offreId` INT( 11 ) NULL ,
CHANGE  `clientId`  `clientId` INT( 11 ) NULL ,
CHANGE  `userId`  `userId` INT( 100 ) NULL ;

ALTER TABLE  `offre` CHANGE  `clientId`  `clientId` INT( 11 ) NULL ,
CHANGE  `userId`  `userId` INT( 11 ) NULL ;

ALTER TABLE  `planning` CHANGE  `jobId`  `jobId` INT( 11 ) NULL DEFAULT NULL ,
CHANGE  `offreId`  `offreId` INT( 11 ) NULL DEFAULT NULL ,
CHANGE  `userId`  `userId` INT( 11 ) NULL ;





ALTER TABLE  `planning_logs` CHANGE  `jobId`  `jobId` INT( 11 ) NULL DEFAULT NULL ,
CHANGE  `offreId`  `offreId` INT( 11 ) NULL DEFAULT NULL ,
CHANGE  `userId`  `userId` INT( 100 ) NULL ;

ALTER TABLE  `invoice` CHANGE  `jobId`  `jobId` INT( 11 ) NULL DEFAULT NULL ,
CHANGE  `clientId`  `clientId` INT( 11 ) NULL ;

ALTER TABLE  `job` CHANGE  `startBuild`  `startBuild` DATETIME NULL ,
CHANGE  `endBuild`  `endBuild` DATETIME NULL ,
CHANGE  `requestDate`  `requestDate` DATETIME NULL ;

ALTER TABLE  `job` CHANGE  `price`  `price` VARCHAR( 50 ) CHARACTER SET utf8 COLLATE utf8_bin NULL ;


ALTER TABLE  `product2job` CHANGE  `productId`  `productId` INT( 11 ) NULL DEFAULT NULL ;
ALTER TABLE  `product2job` CHANGE  `jobId`  `jobId` INT( 11 ) NULL DEFAULT NULL ;

ALTER TABLE  `product2offre` CHANGE  `productId`  `productId` INT( 11 ) NULL DEFAULT NULL ,
CHANGE  `offreId`  `offreId` INT( 11 ) NULL DEFAULT NULL ;





ALTER TABLE  `product2offre` CHANGE  `transportId`  `transportId` INT( 11 ) NULL DEFAULT NULL ;











UPDATE `product2offre` SET offreId=null WHERE offreId NOT IN (SELECT id FROM offre);

UPDATE `product2invoice` SET invoiceId=null WHERE invoiceId NOT IN (SELECT id FROM invoice);




UPDATE `product2offre` SET jobId=NULL WHERE jobId NOT IN(SELECT id FROM job);

UPDATE `product2offre` SET offreId=NULL WHERE offreId NOT IN(SELECT id FROM offre);

UPDATE `tent2job` SET offreId=NULL WHERE offreId NOT IN (SELECT id FROM offre);

UPDATE `tent2job` SET jobId=NULL WHERE jobId NOT IN (SELECT id FROM job);

UPDATE `tent2job` SET tentId=NULL WHERE tentId NOT IN (SELECT id FROM tent);

UPDATE `tent2offre` SET offreId=NULL WHERE offreId NOT IN (SELECT id FROM offre);

UPDATE `tent2offre` SET jobId=NULL WHERE jobId NOT IN (SELECT id FROM job);

UPDATE `tent2offre` SET tentId=NULL WHERE tentId NOT IN (SELECT id FROM tent);





UPDATE `address` SET offreId=NULL WHERE offreId NOT IN (SELECT id FROM offre);
UPDATE `address` SET jobId=NULL WHERE jobId NOT IN (SELECT id FROM job);
UPDATE `address` SET clientId=NULL WHERE clientId NOT IN (SELECT id FROM client);
UPDATE `address` SET invoiceId=NULL WHERE invoiceId NOT IN (SELECT id FROM invoice);



UPDATE `chat` SET userId=NULL WHERE userId NOT IN (SELECT id FROM user);


UPDATE `client` SET jobId=NULL WHERE jobId NOT IN (SELECT id FROM job);
UPDATE `client` SET userId=NULL WHERE userId NOT IN (SELECT id FROM user);




UPDATE `job` SET offreId=NULL WHERE offreId NOT IN (SELECT id FROM offre);
UPDATE `job` SET clientId=NULL WHERE clientId NOT IN (SELECT id FROM client);
UPDATE `job` SET userId=NULL WHERE userId NOT IN (SELECT id FROM user);



UPDATE `offre` SET clientId=NULL WHERE clientId NOT IN (SELECT id FROM client);
UPDATE `offre` SET userId=NULL WHERE userId NOT IN (SELECT id FROM user);







UPDATE `planning` SET offreId=NULL WHERE offreId NOT IN (SELECT id FROM offre);
UPDATE `planning` SET jobId=NULL WHERE jobId NOT IN (SELECT id FROM job);
UPDATE `planning` SET userId=NULL WHERE userId NOT IN (SELECT id FROM user);



UPDATE `planning2job` SET offreId=NULL WHERE offreId NOT IN (SELECT id FROM offre);
UPDATE `planning2job` SET jobId=NULL WHERE jobId NOT IN (SELECT id FROM job);
UPDATE `planning2job` SET userId=NULL WHERE userId NOT IN (SELECT id FROM user);

UPDATE `planning2offre` SET offreId=NULL WHERE offreId NOT IN (SELECT id FROM offre);
UPDATE `planning2offre` SET jobId=NULL WHERE jobId NOT IN (SELECT id FROM job);
UPDATE `planning2offre` SET userId=NULL WHERE userId NOT IN (SELECT id FROM user);

UPDATE `planning_logs` SET jobId=NULL WHERE jobId NOT IN (SELECT id FROM job);
UPDATE `planning_logs` SET offreId=NULL WHERE offreId NOT IN (SELECT id FROM offre);
UPDATE `planning_logs` SET userId=NULL WHERE userId NOT IN (SELECT id FROM user);



UPDATE `invoice` SET jobId=NULL WHERE jobId NOT IN (SELECT id FROM job);
UPDATE `invoice` SET clientId=NULL WHERE clientId NOT IN (SELECT id FROM client);


UPDATE `slice` SET offreId=NULL WHERE offreId NOT IN (SELECT id FROM offre);
UPDATE `slice` SET invoiceId=NULL WHERE invoiceId NOT IN (SELECT id FROM invoice);
UPDATE `slice` SET jobId=NULL WHERE jobId NOT IN (SELECT id FROM job);



UPDATE `tent` SET ownerId=NULL WHERE ownerId NOT IN (SELECT id FROM client);
UPDATE `tent` SET winterOffreId=NULL WHERE winterOffreId NOT IN (SELECT id FROM offre);


UPDATE `slice2job` SET offreId=NULL WHERE offreId NOT IN (SELECT id FROM offre);
UPDATE `slice2job` SET jobId=NULL WHERE jobId NOT IN (SELECT id FROM job);
UPDATE `slice2job` SET invoiceId=NULL WHERE invoiceId NOT IN (SELECT id FROM invoice);


UPDATE `slice2offre` SET offreId=NULL WHERE offreId NOT IN (SELECT id FROM offre);
UPDATE `slice2offre` SET jobId=NULL WHERE jobId NOT IN (SELECT id FROM job);
UPDATE `slice2offre` SET invoiceId=NULL WHERE invoiceId NOT IN (SELECT id FROM invoice);





#######
##
##  after structure modification
##
##
#######

UPDATE  `job` SET toffreid = offreId
UPDATE job SET price = replace(price, ',', '.');
UPDATE job SET price = replace(price, '€', '');
UPDATE `job` SET price="0.00" WHERE price="";

UPDATE `product2job` SET jobId=null WHERE jobId NOT IN (SELECT id FROM job);
UPDATE `product2job` SET offreId=null WHERE offreId NOT IN (SELECT id FROM offre);
UPDATE `product2job` SET tentId=null WHERE tentId NOT IN (SELECT id FROM tent);

UPDATE `product2offre` SET transportId=NULL WHERE transportId NOT IN (SELECT id FROM transport);

UPDATE offre SET price = replace(price, ',', '.');
UPDATE offre SET price = replace(price, '€', '');
UPDATE `offre` SET price="0.00" WHERE price="";

UPDATE product2job SET tentId=null WHERE tentId NOT IN (SELECT id FROM tent);
UPDATE product2offre SET tentId=null WHERE tentId NOT IN (SELECT id FROM tent);




UPDATE user SET username_canonical=email;
UPDATE user SET email_canonical=email;
UPDATE user SET username=email;

